<template>
  <div class="container mt-4">
    <h2>Category Management</h2>

    <!-- Add / Update Category Form -->
    <div class="card p-3 mb-4">
      <h5>{{ categoryForm.categoryID ? "Update Category" : "Add Category" }}</h5>
      <div class="mb-2">
        <input
          v-model="categoryForm.categoryName"
          type="text"
          class="form-control"
          placeholder="Category Name"
        />
      </div>
      <div class="mb-2">
        <input
          v-model="categoryForm.description"
          type="text"
          class="form-control"
          placeholder="Description"
        />
      </div>
      <div>
        <button class="btn btn-primary me-2" @click="submitCategory">
          {{ categoryForm.categoryID ? "Update" : "Add" }}
        </button>
        <button class="btn btn-secondary" @click="resetForm">Reset</button>
      </div>
    </div>

    <!-- Categories Table -->
    <div class="card p-3">
      <h5>Categories List</h5>
      <table class="table table-bordered mt-2">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Description</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="cat in categories" :key="cat.categoryID">
            <td>{{ cat.categoryID }}</td>
            <td>{{ cat.categoryName }}</td>
            <td>{{ cat.description }}</td>
            <td>
              <button
                class="btn btn-sm btn-warning me-1"
                @click="editCategory(cat)"
              >
                Edit
              </button>
              <button
                class="btn btn-sm btn-danger"
                @click="deleteCategory(cat.categoryID)"
              >
                Delete
              </button>
            </td>
          </tr>
          <tr v-if="categories.length === 0">
            <td colspan="4" class="text-center">No categories found.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</template>

<script>
import axios from "axios";

export default {
  name: "CategoryManager",
  data() {
    return {
      API_URL: "https://localhost:7208/category",
      categories: [], // reactive variable for display
      categoryForm: {
        categoryID: null,
        categoryName: "",
        description: "",
      },
    };
  },
  methods: {
    // Fetch all categories
    async fetchCategories() {
      try {
        const response = await axios.get(this.API_URL);
        this.categories = response.data;
      } catch (error) {
        console.error("Error fetching categories:", error);
      }
    },

    // Submit Add / Update
    async submitCategory() {
      try {
        if (!this.categoryForm.categoryName) {
          alert("Category Name is required.");
          return;
        }

        if (this.categoryForm.categoryID) {
          // Update existing
          await axios.put(
            `${this.API_URL}/${this.categoryForm.categoryID}`,
            {
              categoryName: this.categoryForm.categoryName,
              description: this.categoryForm.description,
            },
            { headers: { "Content-Type": "application/json" } }
          );
        } else {
          // Add new
          await axios.post(
            this.API_URL,
            {
              categoryName: this.categoryForm.categoryName,
              description: this.categoryForm.description,
            },
            { headers: { "Content-Type": "application/json" } }
          );
        }

        this.resetForm();
        this.fetchCategories(); // refresh table
      } catch (error) {
        console.error("Error submitting category:", error);
      }
    },

    // Populate form for editing
    editCategory(cat) {
      this.categoryForm = { ...cat }; // copy object
    },

    // Delete category
    async deleteCategory(categoryId) {
      if (!confirm("Are you sure you want to delete this category?")) return;

      try {
        await axios.delete(`${this.API_URL}/${categoryId}`);
        this.fetchCategories(); // refresh table
      } catch (error) {
        console.error("Error deleting category:", error);
      }
    },

    // Reset form
    resetForm() {
      this.categoryForm = {
        categoryID: null,
        categoryName: "",
        description: "",
      };
    },
  },
  mounted() {
    this.fetchCategories(); // auto load categories
  },
};
</script>

<style scoped>
.container {
  max-width: 800px;
}

.card {
  background-color: #f8f9fa;
  border-radius: 5px;
}

.btn {
  margin-top: 5px;
}
</style>
